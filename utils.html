<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="oneflow.env" href="env.html" /><link rel="prev" title="oneflow.nn.image" href="image.html" />

    <meta name="generator" content="sphinx-3.5.4, furo 2021.04.11.beta34"/>
        <title>oneflow.utils - OneFlow documentation</title>
      <link rel="stylesheet" href="_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" href="_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">OneFlow  documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">OneFlow  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">OneFlow Python API</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="oneflow.html">oneflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor.html">oneflow.Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor_attributes.html">Tensor Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.html">oneflow.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="functional.html">oneflow.nn.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="autograd.html">oneflow.autograd</a></li>
<li class="toctree-l1"><a class="reference internal" href="cuda.html">oneflow.cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.html">oneflow.distributed</a></li>
<li class="toctree-l1"><a class="reference internal" href="linalg.html">oneflow.linalg</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.init.html">oneflow.nn.init</a></li>
<li class="toctree-l1"><a class="reference internal" href="optim.html">oneflow.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="module.html">oneflow.nn.Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="graph.html">oneflow.nn.Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="image.html">oneflow.nn.image</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">oneflow.utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="env.html">oneflow.env</a></li>
<li class="toctree-l1"><a class="reference internal" href="comm.html">oneflow.comm</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="oneflow-utils">
<h1>oneflow.utils<a class="headerlink" href="#oneflow-utils" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-oneflow.utils.data">
<span id="utils"></span><h2>Utils<a class="headerlink" href="#module-oneflow.utils.data" title="Permalink to this headline">¶</a></h2>
<p>Copyright 2020 The OneFlow Authors. All rights reserved.</p>
<p>Licensed under the Apache License, Version 2.0 (the “License”);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<blockquote>
<div><p><a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
</div></blockquote>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
<dl class="py class">
<dt id="oneflow.utils.data.BatchSampler">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">oneflow.utils.data.</span></code><code class="sig-name descname"><span class="pre">BatchSampler</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sampler</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">oneflow.utils.data.sampler.Sampler</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drop_last</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.BatchSampler" title="Permalink to this definition">¶</a></dt>
<dd><p>将另一个采样器包装为 mini-batch 索引。</p>
<dl>
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>sampler</strong> (Sampler or Iterable) - 原采样器。可以是任何可迭代对象。</p></li>
<li><p><strong>batch_size</strong> (int) - mini-batch 的大小</p></li>
<li><p><strong>drop_last</strong> (bool) - 如果为 <code class="docutils literal notranslate"><span class="pre">True</span></code> ，采样器会在最后一个 batch 小于 <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> 时将其丢弃。</p></li>
</ul>
</dd>
<dt>样例：</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">oneflow</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">oneflow.utils.data</span> <span class="k">import</span> <span class="n">BatchSampler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">oneflow.utils.data</span> <span class="k">import</span> <span class="n">SequentialSampler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">BatchSampler</span><span class="p">(</span><span class="n">SequentialSampler</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">drop_last</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="go">[[0, 1, 2], [3, 4, 5], [6, 7, 8], [9]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">BatchSampler</span><span class="p">(</span><span class="n">SequentialSampler</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">drop_last</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="go">[[0, 1, 2], [3, 4, 5], [6, 7, 8]]</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt id="oneflow.utils.data.ConcatDataset">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">oneflow.utils.data.</span></code><code class="sig-name descname"><span class="pre">ConcatDataset</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasets</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">oneflow.utils.data.dataset.Dataset</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.ConcatDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>一个由多个数据集串接而成的数据集。这个类可用于聚集不同的已有数据集。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>datasets</strong> (sequence) - 被串接的数据集列表</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="oneflow.utils.data.ConcatDataset.cumsum">
<em class="property"><span class="pre">static</span> </em><code class="sig-name descname"><span class="pre">cumsum</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sequence</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.ConcatDataset.cumsum" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py attribute">
<dt id="oneflow.utils.data.ConcatDataset.cumulative_sizes">
<code class="sig-name descname"><span class="pre">cumulative_sizes</span></code><em class="property"><span class="pre">:</span> <span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#oneflow.utils.data.ConcatDataset.cumulative_sizes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py attribute">
<dt id="oneflow.utils.data.ConcatDataset.datasets">
<code class="sig-name descname"><span class="pre">datasets</span></code><em class="property"><span class="pre">:</span> <span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">oneflow.utils.data.dataset.Dataset</span><span class="p"><span class="pre">[</span></span><span class="pre">T_co</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#oneflow.utils.data.ConcatDataset.datasets" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt id="oneflow.utils.data.DataLoader">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">oneflow.utils.data.</span></code><code class="sig-name descname"><span class="pre">DataLoader</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="pre">dataset:</span> <span class="pre">oneflow.utils.data.dataset.Dataset[T_co],</span> <span class="pre">batch_size:</span> <span class="pre">Optional[int]</span> <span class="pre">=</span> <span class="pre">1,</span> <span class="pre">shuffle:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False,</span> <span class="pre">sampler:</span> <span class="pre">Optional[oneflow.utils.data.sampler.Sampler[int]]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">batch_sampler:</span> <span class="pre">Optional[oneflow.utils.data.sampler.Sampler[Sequence[int]]]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">num_workers:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">0,</span> <span class="pre">collate_fn:</span> <span class="pre">Optional[Callable[[List[T]],</span> <span class="pre">Any]]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">drop_last:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False,</span> <span class="pre">timeout:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0,</span> <span class="pre">worker_init_fn:</span> <span class="pre">Optional[Callable[[int],</span> <span class="pre">None]]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">multiprocessing_context=None,</span> <span class="pre">generator=&lt;oneflow._oneflow_internal.Generator</span> <span class="pre">object&gt;,</span> <span class="pre">*,</span> <span class="pre">prefetch_factor:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">2,</span> <span class="pre">persistent_workers:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.DataLoader" title="Permalink to this definition">¶</a></dt>
<dd><p>数据加载器。结合一个数据集和采样器，并为数据集提供一个可迭代对象。
数据加载器同时支持 map-style 和 iterable-style 数据集的单/多线程加载，且可以自定义加载顺序和可选的自动处理和内存锁定。
查看 <code class="xref py py-mod docutils literal notranslate"><span class="pre">flow.utils.data</span></code> 文档页面以获取更多信息。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>dataset</strong> (Dataset) - 用于提取并加载数据的数据集</p></li>
<li><p><strong>batch_size</strong> (int, 可选) - 每个 batch 加载的样本数量 (默认： <code class="docutils literal notranslate"><span class="pre">1</span></code>)</p></li>
<li><p><strong>shuffle</strong> (bool, 可选) - 设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 使得数据在每个时刻重新打乱 (默认： <code class="docutils literal notranslate"><span class="pre">False</span></code>)</p></li>
<li><p><strong>sampler</strong> (Sampler or Iterable, 可选) - 定义从数据库中抽取样本的策略。可以是任何采用了 <code class="docutils literal notranslate"><span class="pre">__len__</span></code> 的 <code class="docutils literal notranslate"><span class="pre">Iterable</span></code>。如果该参数已被指定，则 <code class="xref py py-attr docutils literal notranslate"><span class="pre">shuffle</span></code> 无法被指定</p></li>
<li><p><strong>batch_sampler</strong> (Sampler or Iterable, 可选) - 类似 <a class="reference internal" href="#oneflow.utils.data.DataLoader.sampler" title="oneflow.utils.data.DataLoader.sampler"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sampler</span></code></a>, 但每次返回一个 batch 索引。与 <a class="reference internal" href="#oneflow.utils.data.DataLoader.batch_size" title="oneflow.utils.data.DataLoader.batch_size"><code class="xref py py-attr docutils literal notranslate"><span class="pre">batch_size</span></code></a>, <code class="xref py py-attr docutils literal notranslate"><span class="pre">shuffle</span></code> , <a class="reference internal" href="#oneflow.utils.data.DataLoader.sampler" title="oneflow.utils.data.DataLoader.sampler"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sampler</span></code></a>,和 <a class="reference internal" href="#oneflow.utils.data.DataLoader.drop_last" title="oneflow.utils.data.DataLoader.drop_last"><code class="xref py py-attr docutils literal notranslate"><span class="pre">drop_last</span></code></a> 互斥</p></li>
<li><p><strong>num_workers</strong> (int, 可选) - 被用于加载数据的子线程数量 (默认： <code class="docutils literal notranslate"><span class="pre">0</span></code>). <code class="docutils literal notranslate"><span class="pre">0</span></code> 意味着所有数据都将在主进程加载</p></li>
<li><p><strong>collate_fn</strong> (callable, 可选) - 将一个样本列表合并成 mini-batch 张量。在从 map-style 数据集中使用批加载时被调用</p></li>
<li><p><strong>drop_last</strong> (bool, 可选) - 设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 以在数据集大小无法被 batch 大小整除时将最后一个不完整 batch 丢弃。当为 <code class="docutils literal notranslate"><span class="pre">False</span></code> 时，如果数据集大小无法被 batch 大小整除，最后一个 batch 将相对较小 (默认： <code class="docutils literal notranslate"><span class="pre">False</span></code>)</p></li>
<li><p><strong>timeout</strong> (numeric, 可选) - 若为正数，该参数为从 worker 处收集 batch 的 timeout 值。应总为非负值 (默认： <code class="docutils literal notranslate"><span class="pre">0</span></code>)</p></li>
<li><p><strong>worker_init_fn</strong> (callable, 可选) - 如果不是 <code class="docutils literal notranslate"><span class="pre">None</span></code>, 该参数将在 seeding 之后和加载数据前，与 worker id (an int in <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">num_workers</span> <span class="pre">-</span> <span class="pre">1]</span></code>)一起在每个 worker 的子进程被调用，以作为输入 (默认： <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p></li>
<li><p><strong>prefetch_factor</strong> (int, 可选, 键word-only arg) - 在每个 worker 之前就被加载的样本数量 <code class="docutils literal notranslate"><span class="pre">2``意味着将会有</span> <span class="pre">2</span> <span class="pre">*</span> <span class="pre">num_workers</span> <span class="pre">个样本在所有</span> <span class="pre">worker</span> <span class="pre">之前被预提取。(default:</span> <span class="pre">``2</span></code>)</p></li>
<li><p><strong>persistent_workers</strong> (bool, 可选) - 如果为 <code class="docutils literal notranslate"><span class="pre">True</span></code>, 数据加载器将不会在数据集被加载后关闭 worker 进程。这将允许 <cite>Dataset</cite> worker 进程保持活跃 (默认： <code class="docutils literal notranslate"><span class="pre">False</span></code>)</p></li>
</ul>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>如果 <code class="docutils literal notranslate"><span class="pre">spawn</span></code> 启动方法被使用, <code class="xref py py-attr docutils literal notranslate"><span class="pre">worker_init_fn</span></code>
不能为 unpicklable 对象, e.g., lambda 函数。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">len(dataloader)</span></code> 启动法将基于采样器的长度。
当 <a class="reference internal" href="#oneflow.utils.data.DataLoader.dataset" title="oneflow.utils.data.DataLoader.dataset"><code class="xref py py-attr docutils literal notranslate"><span class="pre">dataset</span></code></a> 为 <code class="xref py py-class docutils literal notranslate"><span class="pre">IterableDataset</span></code> 时,
它将返回一个基于 <code class="docutils literal notranslate"><span class="pre">len(dataset)</span> <span class="pre">/</span> <span class="pre">batch_size</span></code> 的估算值，并将根据 <a class="reference internal" href="#oneflow.utils.data.DataLoader.drop_last" title="oneflow.utils.data.DataLoader.drop_last"><code class="xref py py-attr docutils literal notranslate"><span class="pre">drop_last</span></code></a> 进行适当取整，
不考虑多线程加载配置。这是 OneFlow 能做出的最理想估算，因为 OneFlow 相信 user <a class="reference internal" href="#oneflow.utils.data.DataLoader.dataset" title="oneflow.utils.data.DataLoader.dataset"><code class="xref py py-attr docutils literal notranslate"><span class="pre">dataset</span></code></a> 代码能够正确的处理多线程加载
来避免重复数据。</p>
<p>但是，如果多个 worker 的数据分片有不完全的末尾 batch ，此类估算仍有可能为不准确的，因为
(1) 一个原本完整的 batch 可能被分割为多个，且(2) 当 <a class="reference internal" href="#oneflow.utils.data.DataLoader.drop_last" title="oneflow.utils.data.DataLoader.drop_last"><code class="xref py py-attr docutils literal notranslate"><span class="pre">drop_last</span></code></a> 被设定时，原本能合成一个以上
batch 的样本将被丢弃。遗憾的是， OneFlow 通常无法检测这类情况。</p>
</div>
<dl class="py attribute">
<dt id="oneflow.utils.data.DataLoader.batch_size">
<code class="sig-name descname"><span class="pre">batch_size</span></code><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#oneflow.utils.data.DataLoader.batch_size" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py method">
<dt id="oneflow.utils.data.DataLoader.check_worker_number_rationality">
<code class="sig-name descname"><span class="pre">check_worker_number_rationality</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.DataLoader.check_worker_number_rationality" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py attribute">
<dt id="oneflow.utils.data.DataLoader.dataset">
<code class="sig-name descname"><span class="pre">dataset</span></code><em class="property"><span class="pre">:</span> <span class="pre">oneflow.utils.data.dataset.Dataset</span><span class="p"><span class="pre">[</span></span><span class="pre">T_co</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#oneflow.utils.data.DataLoader.dataset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py attribute">
<dt id="oneflow.utils.data.DataLoader.drop_last">
<code class="sig-name descname"><span class="pre">drop_last</span></code><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#oneflow.utils.data.DataLoader.drop_last" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py attribute">
<dt id="oneflow.utils.data.DataLoader.num_workers">
<code class="sig-name descname"><span class="pre">num_workers</span></code><em class="property"><span class="pre">:</span> <span class="pre">int</span></em><a class="headerlink" href="#oneflow.utils.data.DataLoader.num_workers" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py attribute">
<dt id="oneflow.utils.data.DataLoader.prefetch_factor">
<code class="sig-name descname"><span class="pre">prefetch_factor</span></code><em class="property"><span class="pre">:</span> <span class="pre">int</span></em><a class="headerlink" href="#oneflow.utils.data.DataLoader.prefetch_factor" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py attribute">
<dt id="oneflow.utils.data.DataLoader.sampler">
<code class="sig-name descname"><span class="pre">sampler</span></code><em class="property"><span class="pre">:</span> <span class="pre">oneflow.utils.data.sampler.Sampler</span></em><a class="headerlink" href="#oneflow.utils.data.DataLoader.sampler" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py attribute">
<dt id="oneflow.utils.data.DataLoader.timeout">
<code class="sig-name descname"><span class="pre">timeout</span></code><em class="property"><span class="pre">:</span> <span class="pre">float</span></em><a class="headerlink" href="#oneflow.utils.data.DataLoader.timeout" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt id="oneflow.utils.data.Dataset">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">oneflow.utils.data.</span></code><code class="sig-name descname"><span class="pre">Dataset</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.Dataset" title="Permalink to this definition">¶</a></dt>
<dd><p>一个代表 <a class="reference internal" href="#oneflow.utils.data.Dataset" title="oneflow.utils.data.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a> 的抽象类。</p>
<p>所有能将键映射为数据样本的数据集都应作为该类的子类。所有子类都应替换 <code class="xref py py-meth docutils literal notranslate"><span class="pre">__getitem__()</span></code> 以支持使用指定键提取数据样本。子集也能可选性的替换 <code class="xref py py-meth docutils literal notranslate"><span class="pre">__len__()</span></code> ，一个在许多 <code class="xref py py-class docutils literal notranslate"><span class="pre">Sampler</span></code> 实现和 <code class="xref py py-class docutils literal notranslate"><span class="pre">DataLoader</span></code> 的默认选项中返回数据集大小的参数。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataLoader</span></code> 在默认情况下会构建一个生成整型索引的索引采样器。
若要处理由非整型的索引/键映射成的数据集，则需要提供一个自定义采样器。</p>
</div>
</dd></dl>
<dl class="py class">
<dt id="oneflow.utils.data.IterableDataset">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">oneflow.utils.data.</span></code><code class="sig-name descname"><span class="pre">IterableDataset</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.IterableDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>一个可迭代数据集。</p>
<p>所有包含可迭代的数据样本的数据集都应作为此类的子类。此类数据集在数据来源为数据流时尤其有用。</p>
<p>所有子类都应替换 <code class="xref py py-meth docutils literal notranslate"><span class="pre">__iter__()</span></code> ，一个用于返回本数据集中迭代器的参数。</p>
<p>当一个子类和 <code class="xref py py-class docutils literal notranslate"><span class="pre">DataLoader</span></code> 同时使用时，数据集中的每个内容都将从 <code class="xref py py-class docutils literal notranslate"><span class="pre">DataLoader</span></code> 中的迭代器中生成。当 <code class="xref py py-attr docutils literal notranslate"><span class="pre">num_workers</span> <span class="pre">&gt;</span> <span class="pre">0</span></code> 时，每个 worker 进程都将拥有一个数据集对象的不同拷贝，所以通常偏好将每个拷贝独立配置以避免 worker 返回重复数据。</p>
<p>样例1：在 <code class="xref py py-meth docutils literal notranslate"><span class="pre">__iter__()</span></code> 中将负荷分配给所有 worker：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">oneflow</span> <span class="kn">as</span> <span class="nn">flow</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyIterableDataset</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">IterableDataset</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">(</span><span class="n">MyIterableDataset</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="gp">... </span>        <span class="k">assert</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="n">start</span><span class="p">,</span> <span class="s2">"this example code only works with end &gt;= start"</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">iter_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
<span class="gp">... </span>        <span class="n">iter_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">iter_start</span><span class="p">,</span> <span class="n">iter_end</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 应提供数据为 range(3,7) 的数据集，i.e., [3, 4, 5, 6].</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span> <span class="o">=</span> <span class="n">MyIterableDataset</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 单线程加载</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
<span class="go">[tensor([3], dtype=oneflow.int64), tensor([4], dtype=oneflow.int64), tensor([5], dtype=oneflow.int64), tensor([6], dtype=oneflow.int64)]</span>
</pre></div>
</div>
<p>样例2：使用 <code class="xref py py-attr docutils literal notranslate"><span class="pre">worker_init_fn</span></code> 将负荷分配给所有 worker：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">oneflow</span> <span class="kn">as</span> <span class="nn">flow</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyIterableDataset</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">IterableDataset</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">(</span><span class="n">MyIterableDataset</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="gp">... </span>        <span class="k">assert</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="n">start</span><span class="p">,</span> <span class="s2">"this example code only works with end &gt;= start"</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 应提供数据为 range(3,7) 的数据集，i.e., [3, 4, 5, 6].</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span> <span class="o">=</span> <span class="n">MyIterableDataset</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 单线程加载</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
<span class="go">[tensor([3], dtype=oneflow.int64), tensor([4], dtype=oneflow.int64), tensor([5], dtype=oneflow.int64), tensor([6], dtype=oneflow.int64)]</span>
</pre></div>
</div>
<dl class="py attribute">
<dt id="oneflow.utils.data.IterableDataset.functions">
<code class="sig-name descname"><span class="pre">functions</span></code><em class="property"><span class="pre">:</span> <span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span></em><em class="property"> <span class="pre">=</span> <span class="pre">{}</span></em><a class="headerlink" href="#oneflow.utils.data.IterableDataset.functions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py attribute">
<dt id="oneflow.utils.data.IterableDataset.reduce_ex_hook">
<code class="sig-name descname"><span class="pre">reduce_ex_hook</span></code><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span></em><em class="property"> <span class="pre">=</span> <span class="pre">None</span></em><a class="headerlink" href="#oneflow.utils.data.IterableDataset.reduce_ex_hook" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py method">
<dt id="oneflow.utils.data.IterableDataset.register_datapipe_as_function">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">register_datapipe_as_function</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">function_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cls_to_register</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.IterableDataset.register_datapipe_as_function" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py method">
<dt id="oneflow.utils.data.IterableDataset.register_function">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">register_function</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">function_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">function</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.IterableDataset.register_function" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py method">
<dt id="oneflow.utils.data.IterableDataset.set_reduce_ex_hook">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">set_reduce_ex_hook</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hook_fn</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.IterableDataset.set_reduce_ex_hook" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt id="oneflow.utils.data.RandomSampler">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">oneflow.utils.data.</span></code><code class="sig-name descname"><span class="pre">RandomSampler</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Sized</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replacement</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_samples</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">generator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.RandomSampler" title="Permalink to this definition">¶</a></dt>
<dd><p>将元素随机采样。如果没有替换，则直接采样一个完整的打乱的数据集。如果有替换，则用户可以指定抽取的数量。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>data_source</strong> (Dataset) - 用于采样的数据集</p></li>
<li><p><strong>replacement</strong> (bool) - 为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 时，样本将根据指定方式被抽取，默认为 <code class="docutils literal notranslate"><span class="pre">False</span></code></p></li>
<li><p><strong>num_samples</strong> (int) - 抽取的数量，默认为 <cite>len(dataset)</cite> 。该参数只有在 <cite>replacement</cite> 为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 时需要被指定</p></li>
<li><p><strong>generator</strong> (Generator) - 采样中被使用的生成器。</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt id="oneflow.utils.data.RandomSampler.data_source">
<code class="sig-name descname"><span class="pre">data_source</span></code><em class="property"><span class="pre">:</span> <span class="pre">Sized</span></em><a class="headerlink" href="#oneflow.utils.data.RandomSampler.data_source" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py method">
<dt id="oneflow.utils.data.RandomSampler.num_samples">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">num_samples</span></code><a class="headerlink" href="#oneflow.utils.data.RandomSampler.num_samples" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py attribute">
<dt id="oneflow.utils.data.RandomSampler.replacement">
<code class="sig-name descname"><span class="pre">replacement</span></code><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#oneflow.utils.data.RandomSampler.replacement" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt id="oneflow.utils.data.Sampler">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">oneflow.utils.data.</span></code><code class="sig-name descname"><span class="pre">Sampler</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Sized</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.Sampler" title="Permalink to this definition">¶</a></dt>
<dd><p>所有采样器的基本类。</p>
<p>所有采样器子类都需要提供一个用于迭代数据集元素的 <code class="xref py py-meth docutils literal notranslate"><span class="pre">__iter__()</span></code> 方法，和一个返回迭代器长度的 <code class="xref py py-meth docutils literal notranslate"><span class="pre">__len__()</span></code> 方法。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">__len__()</span></code> 方法并不严格的在 <code class="xref py py-class docutils literal notranslate"><span class="pre">DataLoader</span></code> 中被要求，但是在任何有关计算 <code class="xref py py-class docutils literal notranslate"><span class="pre">DataLoader</span></code> 的长度的情况下都是必须的。</p>
</div>
</dd></dl>
<dl class="py class">
<dt id="oneflow.utils.data.SequentialSampler">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">oneflow.utils.data.</span></code><code class="sig-name descname"><span class="pre">SequentialSampler</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_source</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.SequentialSampler" title="Permalink to this definition">¶</a></dt>
<dd><p>依次采样元素，总是以相同的顺序。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>data_source</strong> (Dataset) - 用于采样的数据集</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt id="oneflow.utils.data.SequentialSampler.data_source">
<code class="sig-name descname"><span class="pre">data_source</span></code><em class="property"><span class="pre">:</span> <span class="pre">Sized</span></em><a class="headerlink" href="#oneflow.utils.data.SequentialSampler.data_source" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt id="oneflow.utils.data.Subset">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">oneflow.utils.data.</span></code><code class="sig-name descname"><span class="pre">Subset</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">oneflow.utils.data.dataset.Dataset</span><span class="p"><span class="pre">[</span></span><span class="pre">T_co</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indices</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.Subset" title="Permalink to this definition">¶</a></dt>
<dd><p>一个由数据集的指定索引形成的子集。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>dataset</strong> (Dataset) - 整个数据集</p></li>
<li><p><strong>indices</strong> (sequence) - 被选入子集的索引</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt id="oneflow.utils.data.Subset.dataset">
<code class="sig-name descname"><span class="pre">dataset</span></code><em class="property"><span class="pre">:</span> <span class="pre">oneflow.utils.data.dataset.Dataset</span><span class="p"><span class="pre">[</span></span><span class="pre">T_co</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#oneflow.utils.data.Subset.dataset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py attribute">
<dt id="oneflow.utils.data.Subset.indices">
<code class="sig-name descname"><span class="pre">indices</span></code><em class="property"><span class="pre">:</span> <span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#oneflow.utils.data.Subset.indices" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt id="oneflow.utils.data.SubsetRandomSampler">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">oneflow.utils.data.</span></code><code class="sig-name descname"><span class="pre">SubsetRandomSampler</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">indices</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">generator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.SubsetRandomSampler" title="Permalink to this definition">¶</a></dt>
<dd><p>根据给定的索引列表随机采样元素，没有替换机制。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>indices</strong> (sequence) - 一个索引的序列</p></li>
<li><p><strong>generator</strong> (Generator) - 用于采样的生成器</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt id="oneflow.utils.data.SubsetRandomSampler.indices">
<code class="sig-name descname"><span class="pre">indices</span></code><em class="property"><span class="pre">:</span> <span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#oneflow.utils.data.SubsetRandomSampler.indices" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt id="oneflow.utils.data.TensorDataset">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">oneflow.utils.data.</span></code><code class="sig-name descname"><span class="pre">TensorDataset</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">tensors</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">oneflow._oneflow_internal.Tensor</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.TensorDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>包装张量的数据集。</p>
<p>每个样本都将通过索引张量的第一个维度来提取。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>tensors</strong> (tensor) - 第一维度大小相同的张量</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt id="oneflow.utils.data.random_split">
<code class="sig-prename descclassname"><span class="pre">oneflow.utils.data.</span></code><code class="sig-name descname"><span class="pre">random_split</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="pre">dataset:</span> <span class="pre">oneflow.utils.data.dataset.Dataset[T],</span> <span class="pre">lengths:</span> <span class="pre">Sequence[int],</span> <span class="pre">generator:</span> <span class="pre">Optional[object]</span> <span class="pre">=</span> <span class="pre">&lt;built-in</span> <span class="pre">method</span> <span class="pre">default_generator</span> <span class="pre">of</span> <span class="pre">PyCapsule</span> <span class="pre">object&gt;</span></em><span class="sig-paren">)</span> → <span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">oneflow.utils.data.dataset.Subset</span><span class="p"><span class="pre">[</span></span><span class="pre">T</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#oneflow.utils.data.random_split" title="Permalink to this definition">¶</a></dt>
<dd><p>将数据集随机拆分为给定长度的非重叠新数据集。可选择使用生成器以获得可重复的结果。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span>   <span class="n">random_split</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="n">flow</span><span class="o">.</span><span class="n">Generator</span><span class="p">()</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">))</span>
</pre></div>
</div>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>dataset</strong> (Dataset) - 待拆分的数据集</p></li>
<li><p><strong>lengths</strong> (sequence) - 新数据集的长度</p></li>
<li><p><strong>generator</strong> (Generator) - 用于随机排列的生成器</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<span class="target" id="module-oneflow.utils.data.distributed"></span><p>Copyright 2020 The OneFlow Authors. All rights reserved.</p>
<p>Licensed under the Apache License, Version 2.0 (the “License”);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<blockquote>
<div><p><a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
</div></blockquote>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
<dl class="py class">
<dt id="oneflow.utils.data.distributed.DistributedSampler">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">oneflow.utils.data.distributed.</span></code><code class="sig-name descname"><span class="pre">DistributedSampler</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">oneflow.utils.data.dataset.Dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_replicas</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rank</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shuffle</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drop_last</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oneflow.utils.data.distributed.DistributedSampler" title="Permalink to this definition">¶</a></dt>
<dd><p>将数据加载到数据集子集的采样器。</p>
<p>它与 <code class="xref py py-class docutils literal notranslate"><span class="pre">flow.nn.parallel.DistributedDataParallel</span></code> 结合使用时特别有效。在这种情况下，每个进程都可以将 <code class="xref py py-class docutils literal notranslate"><span class="pre">DistributedSampler</span></code> 实例作为 <code class="xref py py-class docutils literal notranslate"><span class="pre">DataLoader</span></code> 采样器传递，并加载它独有的原始数据集的子集。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>假定数据集大小不变。</p>
</div>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>dataset</strong> - 用于采样的数据集</p></li>
<li><p><strong>num_replicas</strong> (int, optional) - 参与分布式训练的进程数。默认情况下，<code class="xref py py-attr docutils literal notranslate"><span class="pre">world_size</span></code> 从当前分布式组中检索。</p></li>
<li><p><strong>rank</strong> (int, optional) - 当前进程在 <code class="xref py py-attr docutils literal notranslate"><span class="pre">num_replicas</span></code> 中的 rank。默认情况下，<code class="xref py py-attr docutils literal notranslate"><span class="pre">rank</span></code> 是从当前分布式组中检索的。</p></li>
<li><p><strong>shuffle</strong> (bool, optional) - 如果为 <code class="docutils literal notranslate"><span class="pre">True</span></code> （默认值），采样器将打乱索引</p></li>
<li><p><strong>seed</strong> (int, optional) - 如果 <code class="xref py py-attr docutils literal notranslate"><span class="pre">shuffle=True</span></code>，<code class="xref py py-attr docutils literal notranslate"><span class="pre">seed</span></code> 是用于打乱采样器的随机种子。此数字在分布式组中的所有进程中应相同。默认值为 0。</p></li>
<li><p><strong>drop_last</strong> (bool, optional) - 如果为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，采样器将丢弃数据的尾部以使其在副本数量上均匀可分。如果为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，采样器将添加额外的索引，以使数据在副本中均匀可分。默认值为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</p></li>
</ul>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>在分布式模式下，当每个 epoch 开始时，创建 <code class="xref py py-class docutils literal notranslate"><span class="pre">DataLoader</span></code> 迭代器 <strong>之前</strong> 调用 <a class="reference internal" href="#oneflow.utils.data.distributed.DistributedSampler.set_epoch" title="oneflow.utils.data.distributed.DistributedSampler.set_epoch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_epoch()</span></code></a> 方法是必要的，
以使 shuffle 在多个 epoch 中正常工作。否则，将始终使用相同的顺序。</p>
</div>
<p>示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span>   <span class="n">sampler</span> <span class="o">=</span> <span class="n">DistributedSampler</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_distributed</span> <span class="k">else</span> <span class="bp">None</span>
<span class="o">&gt;</span>   <span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="p">(</span><span class="n">sampler</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">),</span> <span class="n">sampler</span><span class="o">=</span><span class="n">sampler</span><span class="p">)</span>
<span class="o">&gt;</span>   <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_epoch</span><span class="p">,</span> <span class="n">n_epochs</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">if</span> <span class="n">is_distributed</span><span class="p">:</span>
<span class="o">...</span>         <span class="n">sampler</span><span class="o">.</span><span class="n">set_epoch</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">train</span><span class="p">(</span><span class="n">loader</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt id="oneflow.utils.data.distributed.DistributedSampler.set_epoch">
<code class="sig-name descname"><span class="pre">set_epoch</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epoch</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> → <span class="pre">None</span><a class="headerlink" href="#oneflow.utils.data.distributed.DistributedSampler.set_epoch" title="Permalink to this definition">¶</a></dt>
<dd><p>设置采样器的 epoch。</p>
<p>当 <code class="xref py py-attr docutils literal notranslate"><span class="pre">shuffle=True</span></code> 时，可以确保所有副本对每个 epoch 使用不同的随机排序。否则，此采样器的下一次迭代将产生相同的排序。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>epoch</strong> (int) - Epoch 数量</p></li>
</ul>
</dd>
</dl>
</dd></dl>
</dd></dl>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="env.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">oneflow.env</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="image.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">oneflow.nn.image</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2020, OneFlow
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="_sources/utils.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">oneflow.utils</a><ul>
<li><a class="reference internal" href="#module-oneflow.utils.data">Utils</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>